<!DOCTYPE html>
<html>
<head>
<title>Event List</title>
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/user-page.css">

<script>
    
  // Fetch messages and add them to the page.
  function fetchEvents(){
    const urlParams = new URLSearchParams(location.search);
    const url = "/event-list?" + urlParams;
    fetch(url).then((response) => {
      return response.json();
    }).then((events) => {
      const eventContainer = document.getElementById('event-container');
      if(events.length == 0){
       eventContainer.innerHTML = '<p>There are no events at this time. \
       Please check again later</p>';
      }
      else{
       eventContainer.innerHTML = '';  
      }
      events.forEach((event) => {  
       const eventDiv = buildEventDiv(event);
       eventContainer.appendChild(eventDiv);
      });
    });
  }
  
  function buildEventDiv(event){
   // For the event name
   const eventNameDiv = document.createElement('div');
   eventNameDiv.classList.add("left-align");
   var nameLabel = document.createElement("LABEL");
   nameLabel.setAttribute("for", "event-name");
   nameLabel.appendChild(document.createTextNode("Event Name: "));
   eventNameDiv.appendChild(nameLabel);
   eventNameDiv.appendChild(document.createTextNode(event.eventName));

   // Organizers name
   const organizerNamesDiv = document.createElement('div');
   organizerNamesDiv.classList.add("left-align");
   var organizersLabel = document.createElement("LABEL");
   organizersLabel.setAttribute("for", "event-organizers");
   organizersLabel.appendChild(document.createTextNode("Organizers: "));
   organizerNamesDiv.appendChild(organizersLabel);
   organizerNamesDiv.appendChild(document.createTextNode(event.organizerNames));
   
   // Will need some way to nicely format the date/time of the event later on
   const dateDiv = document.createElement('div');
   dateDiv.classList.add('right-align');
   var dateLabel = document.createElement("LABEL");
   dateLabel.setAttribute("for", "event-date");
   dateLabel.appendChild(document.createTextNode("Date: "));
   dateDiv.appendChild(dateLabel);
   dateDiv.appendChild(document.createTextNode(event.eventDate));
   
   //Time of event
   const timeDiv = document.createElement('div');
   timeDiv.classList.add('right-align');
   var timeLabel = document.createElement("LABEL");
   timeLabel.setAttribute("for", "event-time");
   timeLabel.appendChild(document.createTextNode("Time: "));
   timeDiv.appendChild(timeLabel);
   timeDiv.appendChild(document.createTextNode(event.eventTime));

   // Location of event
   const locationDiv = document.createElement('div');
   locationDiv.classList.add('right-align');
   var locationLabel = document.createElement("LABEL");
   locationLabel.setAttribute("for", "event-location");
   locationLabel.appendChild(document.createTextNode("Location: "));
   locationDiv.appendChild(locationLabel);
   locationDiv.appendChild(document.createTextNode(event.location));

   // Group as one thing
   const headerDiv = document.createElement('div');
   headerDiv.classList.add('message-header');
   headerDiv.appendChild(eventNameDiv);
   headerDiv.appendChild(organizerNamesDiv);
   headerDiv.appendChild(dateDiv);
   headerDiv.appendChild(timeDiv);
   headerDiv.appendChild(locationDiv);
   
   const bodyDiv = document.createElement('div');
   bodyDiv.classList.add('message-body');
   bodyDiv.appendChild(document.createTextNode(event.description));
   
   const messageDiv = document.createElement('div');
   messageDiv.classList.add("message-div");
   messageDiv.appendChild(headerDiv);
   messageDiv.appendChild(bodyDiv);
   
   return messageDiv;
  }
  
  // Fetch data and populate the UI of the page.
  function buildUI(){
   fetchEvents();
  }
</script>
</head>
<body onload="buildUI()">
 <div id="content">
  <h1>Event List</h1>
  <hr/>
  <div id="event-container">Loading...</div>
 </div>
</body>
</html>